# EPAGES-CS-2 - E-PAGES Coding Standart 2

<h1>Форматирование кода</h1>

Этот раздел стандарта описывает как принято оформлять код на PHP работая в 1С-Битрикс

<h2>1. Обзор</h2>
<ul>
    <li>Структурирование текста</li>
    <li>Инструкции, выражения</li>
    <li>Пустые строки и пробелы</li>
    <li>Прочее</li>
    <li>Правила форматирование кода в шаблонах</li>
</ul>

<h2>2. Структурирование текста</h2>
<h3>2.1. Длина строки</h3>
Нужно стараться избегать строк длиной более 120 символов. Если строка превышает этот размер, то нужно использовать правила переноса строки.

<h3>2.2. Правила переноса строки</h3>
Если длина строки превышает 120 символов, то необходимо пользоваться следующими правилами переноса:
<ul>
    <li>переносить можно после запятой или перед оператором;</li>
    <li>переносимая строка должна быть сдвинута относительно верхней на один символ табуляции;</li>
</ul>

<b>Пример 1:</b>

для строки
```php
<?php
$arAuthResult = $USER->ChangePassword($USER_LOGIN, $USER_CHECKWORD, $USER_PASSWORD, $USER_CONFIRM_PASSWORD, $USER_LID);
?>
```

допустимым будет следующий вариант переноса:
```php
<?php
$arAuthResult = $USER->ChangePassword($USER_LOGIN, $USER_CHECKWORD,
    $USER_PASSWORD, $USER_CONFIRM_PASSWORD, $USER_LID);
?>
```

<b>Пример 2:</b>

для строки
```php
<?php
if(COption::GetOptionString("main", "new_user_registration", "N")=="Y" && $_SERVER['REQUEST_METHOD']=='POST' && $TYPE=="REGISTRATION" && (!defined("ADMIN_SECTION") || ADMIN_SECTION!==true))
{
}
?>
```

допустимым будет следующий вариант переноса:
```php
<?php
if (COption::GetOptionString("main", "new_user_registration", "N") == "Y"
    && $_SERVER['REQUEST_METHOD'] == 'POST' && $TYPE == "REGISTRATION"
    && (!defined("ADMIN_SECTION") || ADMIN_SECTION !== true))
{
}
?>
```

<h3>2.3. Пробелы и табуляция</h3>
Для форматирования отступов в коде нужно использовать табуляцию. Использование пробелов ЗАПРЕЩЕНО. Причины:
<ul>
	<li>в случае использования табуляции каждый может настроить в своем редакторе желаемый отступ;</li>
	<li>используется один символ вместо нескольких;</li>
</ul>

<h3>2.4. Форматирование подчиненности</h3>
Подчиненный код ДОЛЖЕН быть сдвинут от главного ровно на один символ табуляции. Размещать подчиненный код на той же строке, что и главный ЗАПРЕЩЕНО.
<br/>
<b>Пример:</b>
не правильно писать так:
```php
<?php
if ($a == 0) {$a = 10;
$b = 1;}
?>
```
правильно писать так:
```php
<?php
if ($a == 0)
{
	$a = 10;
	$b = 1;
}
?>
```

<h2>3. Инструкции, выражения</h2>
<h3>3.1. Выражения</h3>
Желательно, чтобы в каждой строчке присутствовало только одно выражение.

<b>Пример:</b>

не правильно писать так:
```php
<?php
$a = $b; $b = $c; $c = $a;
?>
```
правильно писать так:
```php
<?php
$a = $b;
$b = $c;
$c = $a;
?>
```

<h3>3.2. Инструкции if, else, while и т.п.</h3>

Допустим один вид написания инструкций:

<ul>
	<li>если тела всех частей инструкции состоят не более чем из одного выражения, то инструкция все равно ДОЛЖНА иметь фигурные скобки</li>
</ul>
```php
<?php
if (условие) 
{
	действие1;
}
else 
{
	действие2;
} 
?>
```
<ul>
	<li>если тело хотя бы одной из частей состоит более чем из одного выражения, то инструкция ДОЛЖНА записываться в виде</li>
</ul>
```php
<?php
if (условие) 
{
	действие1; 
}
else
{ 
	действие2; 
	действие3; 
} 
?>
```
При написании инструкций ДОЛЖНО строго применяться правило "2.4. Форматирование подчиненности", тело инструкции ДОЛЖНО быть сдвинуто на один символ табуляции вправо от самой инструкции. Фигурные скобки ДОЛЖНЫ находиться на отдельных строках и ДОЛЖНЫ быть на одном уровне с инструкцией.

<b>Пример:</b>

не правильно писать так:
```php
<?php
if ($a == 0) $a = 10;
else{
$a = 5;
$b = 10;}
?>
```
правильно писать так:
```php
<?php
if ($a == 0)
{
	$a = 10;
}
else
{
	$a = 5;
	$b = 10;
}
?>
```

<h3>3.3. Сложные инструкции</h3>
Сложные инструкции СЛЕДУЕТ разбивать по строкам в соответствии с правилами пункта 3.2. (Инструкции if, else, while и т.п.) и 2.2. (Правила переноса строки)

Например,
```php
<?php
if(COption::GetOptionString("main", "new_user_registration", "N")=="Y" && $_SERVER['REQUEST_METHOD']=='POST' &&
$TYPE=="REGISTRATION" && (!defined("ADMIN_SECTION") || ADMIN_SECTION!==true))
{
}
?>
```
можно записать как
```php
<?php
if (COption::GetOptionString("main", "new_user_registration", "N") == "Y"
	&& $_SERVER['REQUEST_METHOD'] == 'POST' && $TYPE == "REGISTRATION"
	&& (!defined("ADMIN_SECTION") || ADMIN_SECTION !== true))
{
}
?>
```

Очень сложные инструкции рекомендуется разбивать на несколько более простых.

Например,
```php
<?php
if((!(defined("STATISTIC_ONLY") && STATISTIC_ONLY && substr($APPLICATION->GetCurPage(), 0,
strlen(BX_ROOT."/admin/"))!=BX_ROOT."/admin/")) && COption::GetOptionString("main", "include_charset", "Y")=="Y"
&& strlen(LANG_CHARSET)>0)
?>
```
можно записать так:
```php
<?php
$publicStatisticOnly = false;
if (defined("STATISTIC_ONLY") && STATISTIC_ONLY 
	&& substr($APPLICATION->GetCurPage(), 0, strlen(BX_ROOT."/admin/")) != BX_ROOT."/admin/")
{
	$publicStatisticOnly = true;
} 

if (!$publicStatisticOnly && strlen(LANG_CHARSET) > 0
	&& COption::GetOptionString("main", "include_charset", "Y") == "Y")
{
}
?>
```
или так:
```php
<?php
if (!defined("STATISTIC_ONLY") || ! STATISTIC_ONLY
	|| substr($APPLICATION->GetCurPage(), 0, strlen(BX_ROOT."/admin/")) == BX_ROOT."/admin/")
{ 
	if (strlen(LANG_CHARSET) > 0 && COption::GetOptionString("main", "include_charset", "Y") == "Y") 
	{

	} 
}
?>
```

<h3>3.4. Форматирование массивов</h3>
Массивы, которые записываются в несколько строк, СЛЕДУЕТ форматировать следующим образом:
```php
<?php
$arFilter = array(
	"key1" => "value1",
	"key2" => array(
		"key21" => "value21",
		"key22" => "value22",
	)
);
?>
```

<h2>4. Пустые строки и пробелы</h2>
<h3>4.1. Пустые строки</h3>
Пустые строки помогают разбивать код приложения на логические сегменты. Несколькими строками МОГУТ отделяться секции в исходном файле. Одной пустой строкой отделяются друг от друга методы, логические секции внутри метода для более удобного чтения. Перед логической секцией РЕКОМЕНДУЕТСЯ вставить комментарий, в котором будет указано назначение этой секции (см. <a href="https://github.com/rodion-arr/EpagesCodingStandards/blob/master/PHP/EPAGES-CS-4.md">EPAGES-CS-4</a>).


<h3>4.1. Пробелы</h3>
После запятой ДОЛЖЕН быть пробел. После точки с запятой, если она не последняя в строке (например в инструкции for), ДОЛЖЕН быть пробел. Перед запятой или точкой с запятой пробелы не ставятся. Все операторы ДОЛЖНЫ быть отделены пробелом от операндов с обеих сторон. Замена пробела символом табуляции НЕ ДОПУСКАЕТСЯ.

<b>Пояснения:</b>

Один пробел используется в объявлении методов после запятой, но не перед скобками:
```php
<?php
TestMethod($a, $b, $c);
?>
```

Пример неправильного использования:
```php
<?php
TestMethod($a,$b,$c);
?>
```

либо
```php
<?php
TestMethod( $a, $b, $c );
?>
```

Так же одиночный пробел может быть использован для выделения операторов:
```php
<?php
$a = $b * $c / $d;
?>
```

Пример неправильного использования:
```php
<?php
$a=$b*$c/$d;
?>
```

Также пробелы используются при форматировании циклов:
```php
<?php
for ($i = 0; $i < 10; $i++)
{
}
?>
```

Пример неправильного использования:
```php
<?php
for($i=0;$i<10;$i++)
{
}
?>
```

Табличное форматирование с помощью символов табуляции НЕ ДОЛЖНО использоваться.

Пример неправильного форматирования:
```php
<?php
$arArray = array(
	"key1RealyLong" => "value1",
	"key2"			=> "value2",
);
?>
```

<b>Замечание:</b> присутствие или отсутствие пробела после if правилами не регламентируется.

<h2>5. Прочее</h2>
В сложных выражениях рекомендуется группировать операции с помощью скобок вне зависимости от того, требует это приоритет операций или нет.

Пример:
```php
<?php
$r = $a + ($b * $c);
?>
```
<h2>6. Правила форматирование кода в шаблонах</h2>
<ul>
	<li>Операторы типа <code>if()</code>, <code>foreach()</code>, <code>while()</code> и т.д. в шаблоне компонента вместе с html-версткой НЕ ДОЛЖНЫ использоваться фигурные скобки. СЛЕДУЕТ заменить фигурные скобки Альтернативным синтаксисом управляющих структур</li>
</ul>

Пример плохого кода, где из-за фигурных скобок пострадала читабельность:
```php
<?if ($condition === true) 
{?>
	<a href="/programm.php">Link text</a>
<?}elseif ($condition === true) 
{?>
	<a href="/programm.php">Link text</a>
<?}else 
{?>
	<a href="/programm.php">Link text</a>
<?}?>
```

Примеры правильного кода:
```php
<?if ($condition === true):?>
	<a href="/programm.php">Link text</a>
<?elseif ($condition === true):?>
	<a href="/programm.php">Link text</a>
<?else:?>
	<a href="/programm.php">Link text</a>
<?endif?>
```

<ul>
	<li>НЕ РЕКОМЕНДУЕТСЯ выводить элементы верстки используя конструкцию языка <code>echo</code> или функцию <code>print</code>. СЛЕДУЕТ прервать PHP-код тэгом <code>?></code> и разместить после него нужные html-элементы</li>
</ul>
